@model Review
@using Microsoft.AspNetCore.Mvc.Localization
@inject IHtmlLocalizer<SharedResource> Localizer
@{
    if (Model.AuthorId == null) throw new ArgumentNullException(nameof(Model.AuthorId));
    if (Model.Product == null) throw new ArgumentNullException(nameof(Model.Product));
    Model.ProductId = Model.Product.Id;
    string head = "Review of " + Model.Product.Title;
    ViewData["Title"] = head;
}

<div class="container-fluid mb-5">
    <h2>@head</h2>
    <hr />
    <form asp-action="EditReview">
        <div hidden>
            <input asp-for=Id />
            <input asp-for=AuthorId />
            <input asp-for=ProductId />
            <input name="TagsForServer" id="TagsForServer" required />
            <input name="RateForServer" id="RateForServer" required />
            <input id="bodyIsFull" required />
        </div>
        <div class="row g-2">
            <div class="col-md">
                <h5>Title </h5>
                <div class="form-floating mb-2">
                    <input asp-for=Title class="form-control" style="font-weight:bolder" type="text" placeholder="Review title" required />
                    <label asp-for="Title" class="form-label">Review title</label>
                    <span asp-validation-for="Title" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md">
                <h5>Tags </h5>
                <div class="form-floating mb-2">
                    <input class="form-control" type="text" id="tagForm" list="tagsList" placeholder="Write tags separated by commas" maxlength="50" onkeyup="checkTag()" autocomplete="on" />
                    <label class="form-label">Write tags separated by commas</label>
                </div>
                <datalist id="tagsList">
                </datalist>
            </div>
        </div>
        <h5 id="tagsLine"></h5>
        <hr />
        <h5>Content</h5>
        <div class="form-group mb-3">
            <textarea asp-for=Body id="tiny" class="form-control" rows="20" placeholder="Content"></textarea>
            <span asp-validation-for="Body" class="text-danger"></span>
        </div>
        <hr />
        <h5 class="mt-2" id="myRating">Rating: -/10</h5>
        <div class="row">
            <div class="col-12">
                @for (int i = 1; i <= 10; i++)
                {
                    <a role="button" class="btn btn-sm btn-light mb-1" style="max-width:28px; max-height:28px" data-attr='@i' name="rateBtn" onclick="changeRate('@i')">
                        <img src="~/icons/star.svg" style="max-width:21px; max-height:21px" aria-hidden="true" />
                    </a>
                }
            </div>
        </div>
        @if(Model.Tags.Count == 0)
        {
            <script>
                addNewTag('@Model.Product.ReleaseYear');
            </script>
        }
        else foreach (var t in Model.Tags)
            {
                <script>
                    addNewTag('@t.Body');
                </script>
            }
        @if (Model.Score != null)
        {
            <script>
                changeRate('@Model.Score.Value');
            </script>
        }
        <hr />
        <button class="btn btn-primary float-end" type="submit" style="min-width:100px">Save review</button>
    </form>
</div>
